In mathematics , a multiset (or bag , or mset ) is a modification of the concept of a set that, unlike a set, allows for multiple instances for each of its elements . The number of instances given for each element is called the multiplicity of that element in the multiset. As a consequence, an infinite number of multisets exist that contain only elements a and b , but vary in the multiplicities of their elements:

These objects are all different when viewed as  multisets, although they are the same set, since they all consist of the same elements. As with sets, and in contrast to tuples , the order in which elements are listed does not matter in discriminating multisets, so { a , a , b } and { a , b , a } denote the same multiset.  To distinguish between sets and multisets, a notation that incorporates square brackets is sometimes used: the multiset { a , a , b } can be denoted by [ a , a , b ] .

The cardinality or "size" of a multiset is the sum of the multiplicities of all its elements. For example, in the multiset { a , a , b , b , b , c } the multiplicities of the members a , b , and c are respectively 2, 3, and 1, and therefore the cardinality of this multiset is 6.

Nicolaas Govert de Bruijn coined the word multiset in the 1970s, according to Donald Knuth . However, the concept of multisets predates the coinage of the word multiset by many centuries. Knuth himself attributes the first study of multisets to the Indian mathematician Bhāskarāchārya , who described permutations of multisets around 1150. Other names have been proposed or used for this concept, including list , bunch , bag , heap , sample , weighted set , collection , and suite .

Wayne Blizard traced multisets back to the very origin of numbers, arguing that "in ancient times, the number n was often represented by a collection of n strokes, tally marks , or units." These and similar collections of objects can be regarded as multisets, because strokes, tally marks, or units are considered indistinguishable. This shows that people implicitly used multisets even before mathematics emerged.

Practical needs for this structure have caused multisets to be rediscovered several times, appearing in literature under different names. For instance, they were important in early AI languages, such as QA4, where they were referred to as bags, a term attributed to Peter Deutsch . A multiset has been also called an aggregate, heap, bunch, sample, weighted set, occurrence set, and fireset (finitely repeated element set).

Although multisets were used implicitly from ancient times, their explicit exploration happened much later. The first known study of multisets is attributed to the Indian mathematician Bhāskarāchārya circa 1150, who described permutations of multisets. The work of Marius Nizolius (1498–1576) contains another early reference to the concept of multisets. Athanasius Kircher found the number of multiset permutations when one element can be repeated. Jean Prestet published a general rule for multiset permutations in 1675. John Wallis explained this rule in more detail in 1685.

Multisets appeared explicitly in the work of Richard Dedekind .

Other mathematicians formalized multisets and began to study them as precise mathematical structures in the 20th century.  For example, Hassler Whitney (1933) described generalized sets ("sets" whose characteristic functions may take any integer value: positive, negative or zero). Monro (1987) investigated the category Mul of multisets and their morphisms , defining a multiset as a set with an equivalence relation between elements "of the same sort ", and a morphism between multisets as a function that respects sorts .  He also introduced a multinumber : a function f ( x ) from a multiset to the natural numbers , giving the multiplicity of element x in the multiset.  Monro argued that the concepts of multiset and multinumber are often mixed indiscriminately, though both are useful.

One of the simplest and most natural examples is the multiset of prime factors of a natural number n . Here the underlying set of elements is the set of prime factors of n . For example, the number 120 has the prime factorization 120 = 2 3 3 1 5 1 , {\displaystyle 120=2^{3}3^{1}5^{1},} which gives the multiset {2, 2, 2, 3, 5} .

A related example is the multiset of solutions of an algebraic equation . A quadratic equation , for example, has two solutions. However, in some cases they are both the same number.  Thus the multiset of solutions of the equation could be {3, 5} , or it could be {4, 4} .  In the latter case it has a solution of multiplicity 2. More generally, the fundamental theorem of algebra asserts that the complex solutions of a polynomial equation of degree d always form a multiset of cardinality d .

A special case of the above are the eigenvalues of a matrix , whose multiplicity is usually defined as their multiplicity as roots of the characteristic polynomial . However two other multiplicities are naturally defined for eigenvalues, their multiplicities as roots of the minimal polynomial , and the geometric multiplicity , which is defined as the dimension of the kernel of A − λI (where λ is an eigenvalue of the matrix A ). These three multiplicities define three multisets of eigenvalues, which may be all different: Let A be a n × n matrix in Jordan normal form that has a single eigenvalue. Its multiplicity is n , its multiplicity as a root of the minimal polynomial is the size of the largest Jordan block, and its geometric multiplicity is the number of Jordan blocks.

A multiset may be formally defined as an ordered pair ( A , m ) where A is the underlying set of the multiset, formed from its distinct elements, and m : A → Z + {\displaystyle m\colon A\to \mathbb {Z} ^{+}} is a function from A to the set of positive integers, giving the multiplicity – that is, the number of occurrences – of the element a in the multiset as the number m ( a ) .

(It is also possible to allow multiplicity 0 or ∞ {\displaystyle \infty } , especially when considering submultisets. This article is restricted to finite, positive multiplicities.)

Representing the function m by its graph (the set of ordered pairs { ( a , m ( a ) ) : a ∈ A } {\displaystyle \{(a,m(a)):a\in A\}} ) allows for writing the multiset { a , a , b } as {( a , 2), ( b , 1) }, and the multiset { a , b } as {( a , 1), ( b , 1) }. This notation is however not commonly used; more compact notations are employed.

If A = { a 1 , … , a n } {\displaystyle A=\{a_{1},\ldots ,a_{n}\}} is a finite set , the multiset ( A , m ) is often represented as

where upper indices equal to 1 are omitted. For example, the multiset { a , a , b } may be written { a 2 , b } {\displaystyle \{a^{2},b\}} or a 2 b . {\displaystyle a^{2}b.} If the elements of the multiset are numbers, a confusion is possible with ordinary arithmetic operations , those normally can be excluded from the context. On the other hand, the latter notation is coherent with the fact that the prime factorization of a positive integer is a uniquely defined multiset, as asserted by the fundamental theorem of arithmetic . Also, a monomial is a multiset of indeterminates ; for example, the monomial x y corresponds to the multiset { x , x , x , y , y }.

A multiset corresponds to an ordinary set if the multiplicity of every element is 1. An indexed family ( a i ) i ∈ I , where i varies over some index set I , may define a multiset, sometimes written { a i } . In this view the underlying set of the multiset is given by the image of the family, and the multiplicity of any element x is the number of index values i such that a i = x {\displaystyle a_{i}=x} . In this article the multiplicities are considered to be finite, so that no element occurs infinitely many times in the family; even in an infinite multiset, the multiplicities are finite numbers.

It is possible to extend the definition of a multiset by allowing multiplicities of individual elements to be infinite cardinals instead of positive integers, but not all properties carry over to this generalization.

Elements of a multiset are generally taken in a fixed set U , sometimes called a universe , which is often the set of natural numbers . An element of U that does not belong to a given multiset is said to have a multiplicity 0 in this multiset. This extends the multiplicity function of the multiset to a function from U to the set N {\displaystyle \mathbb {N} } of non-negative integers. This defines a one-to-one correspondence between these functions and the multisets that have their elements in U .

This extended multiplicity function is commonly called simply the multiplicity function , and suffices for defining multisets when the universe containing the elements has been fixed. This multiplicity function is a generalization of the indicator function of a subset , and shares some properties with it.

The support of a multiset A {\displaystyle A} in a universe U is the underlying set of the multiset. Using the multiplicity function m {\displaystyle m} , it is characterized as Supp ⁡ ( A ) := { x ∈ U ∣ m A ( x ) > 0 } . {\displaystyle \operatorname {Supp} (A):=\{x\in U\mid m_{A}(x)>0\}.}

A multiset is finite if its support is finite, or, equivalently, if its cardinality | A | = ∑ x ∈ Supp ⁡ ( A ) m A ( x ) = ∑ x ∈ U m A ( x ) {\displaystyle |A|=\sum _{x\in \operatorname {Supp} (A)}m_{A}(x)=\sum _{x\in U}m_{A}(x)} is finite. The empty multiset is the unique multiset with an empty support (underlying set), and thus a cardinality 0.

The usual operations of sets may be extended to multisets by using the multiplicity function, in a similar way to using the indicator function for subsets. In the following, A and B are multisets in a given universe U , with multiplicity functions m A {\displaystyle m_{A}} and m B . {\displaystyle m_{B}.}

Two multisets are disjoint if their supports are disjoint sets . This is equivalent to saying that their intersection is the empty multiset or that their sum equals their union.

There is an inclusion–exclusion principle for finite multisets (similar to the one for sets ), stating that a finite union of finite multisets is the difference of two sums of multisets: in the first sum we consider all possible intersections of an odd number of the given multisets, while in the second sum we consider all possible intersections of an even number of the given multisets.

The number of multisets of cardinality k , with elements taken from a finite set of cardinality n , is sometimes called the multiset coefficient or multiset number . This number is written by some authors as ( ( n k ) ) {\displaystyle \textstyle \left(\!\!{n \choose k}\!\!\right)} , a notation that is meant to resemble that of binomial coefficients ; it is used for instance in (Stanley, 1997), and could be pronounced " n multichoose k " to resemble " n choose k " for ( n k ) . {\displaystyle {\tbinom {n}{k}}.} Like the binomial distribution that involves binomial coefficients, there is a negative binomial distribution in which the multiset coefficients occur.  Multiset coefficients should not be confused with the unrelated multinomial coefficients that occur in the multinomial theorem .

The value of multiset coefficients can be given explicitly as ( ( n k ) ) = ( n + k − 1 k ) = ( n + k − 1 ) ! k ! ( n − 1 ) ! = n ( n + 1 ) ( n + 2 ) ⋯ ( n + k − 1 ) k ! , {\displaystyle \left(\!\!{n \choose k}\!\!\right)={n+k-1 \choose k}={\frac {(n+k-1)!}{k!\,(n-1)!}}={n(n+1)(n+2)\cdots (n+k-1) \over k!},} where the second expression is as a binomial coefficient; many authors in fact avoid separate notation and just write binomial coefficients. So, the number of such multisets is the same as the number of subsets of cardinality k of a set of cardinality n + k − 1 . The analogy with binomial coefficients can be stressed by writing the numerator in the above expression as a rising factorial power ( ( n k ) ) = n k ¯ k ! , {\displaystyle \left(\!\!{n \choose k}\!\!\right)={n^{\overline {k}} \over k!},} to match the expression of binomial coefficients using a falling factorial power: ( n k ) = n k _ k ! . {\displaystyle {n \choose k}={n^{\underline {k}} \over k!}.}

For example, there are 4 multisets of cardinality 3 with elements taken from the set {1, 2} of cardinality 2 ( n = 2 , k = 3 ), namely {1, 1, 1} , {1, 1, 2} , {1, 2, 2} , {2, 2, 2} . There are also 4 subsets of cardinality 3 in the set {1, 2, 3, 4} of cardinality 4 ( n + k − 1 ), namely {1, 2, 3} , {1, 2, 4} , {1, 3, 4} , {2, 3, 4} .

One simple way to prove the equality of multiset coefficients and binomial coefficients given above involves representing multisets in the following way.  First, consider the notation for multisets that would represent { a , a , a , a , a , a , b , b , c , c , c , d , d , d , d , d , d , d } (6 a s, 2 b s, 3 c s, 7 d s) in this form:

This is a multiset of cardinality k = 18 made of elements of a set of cardinality n = 4 .  The number of characters including both dots and vertical lines used in this notation is 18 + 4 − 1 .  The number of vertical lines is 4 − 1.  The number of multisets of cardinality 18 is then the number of ways to arrange the 4 − 1 vertical lines among the 18 + 4 − 1 characters, and is thus the number of subsets of cardinality 4 − 1 of a set of cardinality 18 + 4 − 1 .  Equivalently, it is the number of ways to arrange the 18 dots among the 18 + 4 − 1 characters, which is the number of subsets of cardinality 18 of a set of cardinality 18 + 4 − 1 . This is ( 4 + 18 − 1 4 − 1 ) = ( 4 + 18 − 1 18 ) = 1330 , {\displaystyle {4+18-1 \choose 4-1}={4+18-1 \choose 18}=1330,} thus is the value of the multiset coefficient and its equivalencies: ( ( 4 18 ) ) = ( 21 18 ) = 21 ! 18 ! 3 ! = ( 21 3 ) , = 4 ⋅ 5 ⋅ 6 ⋅ 7 ⋅ 8 ⋅ 9 ⋅ 10 ⋅ 11 ⋅ 12 ⋅ 13 ⋅ 14 ⋅ 15 ⋅ 16 ⋅ 17 ⋅ 18 ⋅ 19 ⋅ 20 ⋅ 21 1 ⋅ 2 ⋅ 3 ⋅ 4 ⋅ 5 ⋅ 6 ⋅ 7 ⋅ 8 ⋅ 9 ⋅ 10 ⋅ 11 ⋅ 12 ⋅ 13 ⋅ 14 ⋅ 15 ⋅ 16 ⋅ 17 ⋅ 18 , = 1 ⋅ 2 ⋅ 3 ⋅ 4 ⋅ 5 ⋯ 16 ⋅ 17 ⋅ 18 ⋅ 19 ⋅ 20 ⋅ 21 1 ⋅ 2 ⋅ 3 ⋅ 4 ⋅ 5 ⋯ 16 ⋅ 17 ⋅ 18 ⋅ 1 ⋅ 2 ⋅ 3 , = 19 ⋅ 20 ⋅ 21 1 ⋅ 2 ⋅ 3 . {\displaystyle {\begin{aligned}\left(\!\!{4 \choose 18}\!\!\right)&={21 \choose 18}={\frac {21!}{18!\,3!}}={21 \choose 3},\\[1ex]&={\frac {{\color {red}{\mathfrak {4\cdot 5\cdot 6\cdot 7\cdot 8\cdot 9\cdot 10\cdot 11\cdot 12\cdot 13\cdot 14\cdot 15\cdot 16\cdot 17\cdot 18}}}\cdot \mathbf {19\cdot 20\cdot 21} }{\mathbf {1\cdot 2\cdot 3} \cdot {\color {red}{\mathfrak {4\cdot 5\cdot 6\cdot 7\cdot 8\cdot 9\cdot 10\cdot 11\cdot 12\cdot 13\cdot 14\cdot 15\cdot 16\cdot 17\cdot 18}}}}},\\[1ex]&={\frac {1\cdot 2\cdot 3\cdot 4\cdot 5\cdots 16\cdot 17\cdot 18\;\mathbf {\cdot \;19\cdot 20\cdot 21} }{\,1\cdot 2\cdot 3\cdot 4\cdot 5\cdots 16\cdot 17\cdot 18\;\mathbf {\cdot \;1\cdot 2\cdot 3\quad } }},\\[1ex]&={\frac {19\cdot 20\cdot 21}{1\cdot 2\cdot 3}}.\end{aligned}}}

From the relation between binomial coefficients and multiset coefficients, it follows that the number of multisets of cardinality k in a set of cardinality n can be written ( ( n k ) ) = ( − 1 ) k ( − n k ) . {\displaystyle \left(\!\!{n \choose k}\!\!\right)=(-1)^{k}{-n \choose k}.} Additionally, ( ( n k ) ) = ( ( k + 1 n − 1 ) ) . {\displaystyle \left(\!\!{n \choose k}\!\!\right)=\left(\!\!{k+1 \choose n-1}\!\!\right).}

A recurrence relation for multiset coefficients may be given as ( ( n k ) ) = ( ( n k − 1 ) ) + ( ( n − 1 k ) ) for n , k > 0 {\displaystyle \left(\!\!{n \choose k}\!\!\right)=\left(\!\!{n \choose k-1}\!\!\right)+\left(\!\!{n-1 \choose k}\!\!\right)\quad {\mbox{for }}n,k>0} with ( ( n 0 ) ) = 1 , n ∈ N , and ( ( 0 k ) ) = 0 , k > 0. {\displaystyle \left(\!\!{n \choose 0}\!\!\right)=1,\quad n\in \mathbb {N} ,\quad {\mbox{and}}\quad \left(\!\!{0 \choose k}\!\!\right)=0,\quad k>0.}

The above recurrence may be interpreted as follows.
Let [ n ] := { 1 , … , n } {\displaystyle [n]:=\{1,\dots ,n\}} be the source set. There is always exactly one (empty) multiset of size 0, and if n = 0 there are no larger multisets, which gives the initial conditions.

Now, consider the case in which n , k > 0 . A multiset of cardinality k with elements from [ n ] might or might not contain any instance of the final element n . If it does appear, then by removing n once, one is left with a multiset of cardinality k − 1 of elements from [ n ] , and every such multiset can arise, which gives a total of ( ( n k − 1 ) ) {\displaystyle \left(\!\!{n \choose k-1}\!\!\right)} possibilities.

If n does not appear, then our original multiset is equal to a multiset of cardinality k with elements from [ n − 1] , of which there are ( ( n − 1 k ) ) . {\displaystyle \left(\!\!{n-1 \choose k}\!\!\right).}

Thus, ( ( n k ) ) = ( ( n k − 1 ) ) + ( ( n − 1 k ) ) . {\displaystyle \left(\!\!{n \choose k}\!\!\right)=\left(\!\!{n \choose k-1}\!\!\right)+\left(\!\!{n-1 \choose k}\!\!\right).}

The generating function of the multiset coefficients is very simple, being ∑ d = 0 ∞ ( ( n d ) ) t d = 1 ( 1 − t ) n . {\displaystyle \sum _{d=0}^{\infty }\left(\!\!{n \choose d}\!\!\right)t^{d}={\frac {1}{(1-t)^{n}}}.} As multisets are in one-to-one correspondence with monomials , ( ( n d ) ) {\displaystyle \left(\!\!{n \choose d}\!\!\right)} is also the number of monomials of degree d in n indeterminates. Thus, the above series is also the Hilbert series of the polynomial ring k [ x 1 , … , x n ] . {\displaystyle k[x_{1},\ldots ,x_{n}].}

As ( ( n d ) ) {\displaystyle \left(\!\!{n \choose d}\!\!\right)} is a polynomial in n , it and the generating function are well defined for any complex value of n .

The multiplicative formula allows the definition of multiset coefficients to be extended by replacing n by an arbitrary number α (negative, real , or complex): ( ( α k ) ) = α k ¯ k ! = α ( α + 1 ) ( α + 2 ) ⋯ ( α + k − 1 ) k ( k − 1 ) ( k − 2 ) ⋯ 1 for k ∈ N and arbitrary α . {\displaystyle \left(\!\!{\alpha  \choose k}\!\!\right)={\frac {\alpha ^{\overline {k}}}{k!}}={\frac {\alpha (\alpha +1)(\alpha +2)\cdots (\alpha +k-1)}{k(k-1)(k-2)\cdots 1}}\quad {\text{for }}k\in \mathbb {N} {\text{ and arbitrary }}\alpha .}

With this definition one has a generalization of the negative binomial formula (with one of the variables set to 1), which justifies calling the ( ( α k ) ) {\displaystyle \left(\!\!{\alpha  \choose k}\!\!\right)} negative binomial coefficients: ( 1 − X ) − α = ∑ k = 0 ∞ ( ( α k ) ) X k . {\displaystyle (1-X)^{-\alpha }=\sum _{k=0}^{\infty }\left(\!\!{\alpha  \choose k}\!\!\right)X^{k}.}

This Taylor series formula is valid for all complex numbers α and X with | X | < 1 . It can also be interpreted as an identity of formal power series in X , where it actually can serve as definition of arbitrary powers of series with constant coefficient equal to 1; the point is that with this definition all identities hold that one expects for exponentiation , notably

( 1 − X ) − α ( 1 − X ) − β = ( 1 − X ) − ( α + β ) and ( ( 1 − X ) − α ) − β = ( 1 − X ) − ( − α β ) , {\displaystyle (1-X)^{-\alpha }(1-X)^{-\beta }=(1-X)^{-(\alpha +\beta )}\quad {\text{and}}\quad ((1-X)^{-\alpha })^{-\beta }=(1-X)^{-(-\alpha \beta )},} and formulas such as these can be used to prove identities for the multiset coefficients.

If α is a nonpositive integer n , then all terms with k > − n are zero, and the infinite series becomes a finite sum. However, for other values of α , including positive integers and rational numbers , the series is infinite.

Multisets have various applications. They are becoming fundamental in combinatorics . Multisets have become an important tool in the theory of relational databases , which often uses the synonym bag . For instance, multisets are often used to implement relations in database systems. In particular, a table (without a primary key) works as a multiset, because it can have multiple identical records. Similarly, SQL operates on multisets and returns identical records. For instance, consider "SELECT name from Student". In the case that there are multiple records with name "Sara" in the student table, all of them are shown. That means the result of an SQL query is a multiset; if the result were instead a set, the repetitive records in the result set would have been eliminated. Another application of multisets is in modeling multigraphs . In multigraphs there can be multiple edges between any two given vertices . As such, the entity that specifies the edges is a multiset, and not a set.

There are also other applications. For instance, Richard Rado used multisets as a device to investigate the properties of families of sets. He wrote, "The notion of a set takes no account of multiple occurrence of any one of its members, and yet it is just this kind of information that is frequently of importance. We need only think of the set of roots of a polynomial f ( x ) or the spectrum of a linear operator ."

Different generalizations of multisets have been introduced, studied and applied to solving problems.