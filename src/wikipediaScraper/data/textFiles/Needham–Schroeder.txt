The Needham–Schroeder protocol is one of the two key transport protocols intended for use over an insecure network, both proposed by Roger Needham and Michael Schroeder . These are:

Here, Alice ( A ) {\displaystyle (A)} initiates the communication to Bob ⁠ B {\displaystyle B} ⁠ . S {\displaystyle S} is a server trusted by both parties. In the communication:

The protocol can be specified as follows in security protocol notation :

The protocol is vulnerable to a replay attack (as identified by Denning and Sacco ). If an attacker uses an older, compromised value for ⁠ K A B {\displaystyle K_{AB}} ⁠ , he can then replay the message { K A B , A } K B S {\displaystyle \{K_{AB},A\}_{K_{BS}}} to Bob, who will accept it, being unable to tell that the key is not fresh.

This flaw is fixed in the Kerberos protocol by the inclusion of a timestamp . It can also be fixed with the  use of nonces as described below. At the beginning of the protocol:

The protocol then continues as described through the final three steps as described in the original protocol above . Note that N B ′ {\displaystyle N_{B}'} is a different nonce from ⁠ N B {\displaystyle N_{B}} ⁠ . The inclusion of this new nonce prevents the replaying of a compromised version of { K A B , A } K B S {\displaystyle \{K_{AB},A\}_{K_{BS}}} since such a message would need to be of the form { K A B , A , N B ′ } K B S {\displaystyle \{K_{AB},A,N_{B}'\}_{K_{BS}}} which the attacker can't forge since she does not have ⁠ K B S {\displaystyle K_{BS}} ⁠ .

This assumes the use of a public-key encryption algorithm .

Here, Alice ( A ) {\displaystyle (A)} and Bob ( B ) {\displaystyle (B)} use a trusted server ( S ) {\displaystyle (S)} to distribute public keys on request. These keys are:

The protocol runs as follows:

At the end of the protocol, A {\displaystyle A} and B {\displaystyle B} know each other's identities, and know both N A {\displaystyle N_{A}} and ⁠ N B {\displaystyle N_{B}} ⁠ . These nonces are not known to eavesdroppers.

This protocol is vulnerable to a man-in-the-middle attack . If an impostor I {\displaystyle I} can persuade A {\displaystyle A} to initiate a session with them, they can relay the messages to B {\displaystyle B} and convince B {\displaystyle B} that he is communicating with ⁠ A {\displaystyle A} ⁠ .

Ignoring the traffic to and from S {\displaystyle S} , which is unchanged, the attack runs as follows:

At the end of the attack, B {\displaystyle B} falsely believes that A {\displaystyle A} is communicating with him, and that N A {\displaystyle N_{A}} and N B {\displaystyle N_{B}} are known only to A {\displaystyle A} and ⁠ B {\displaystyle B} ⁠ .

The following example illustrates the attack. Alice ( ⁠ A {\displaystyle A} ⁠ ) would like to contact her bank ( ⁠ B {\displaystyle B} ⁠ ). We assume that an impostor ( ⁠ I {\displaystyle I} ⁠ ) successfully convinces A {\displaystyle A} that they are the bank. As a consequence, A {\displaystyle A} uses the public key of I {\displaystyle I} instead of using the public key of B {\displaystyle B} to encrypt the messages she intends to send to her bank. Therefore, A {\displaystyle A} sends I {\displaystyle I} her nonce encrypted with the public key of ⁠ I {\displaystyle I} ⁠ . I {\displaystyle I} decrypts the message using their private key and contacts B {\displaystyle B} sending it the nonce of A {\displaystyle A} encrypted with the public key of B {\displaystyle B} . B {\displaystyle B} has no way to know that this message was actually sent by ⁠ I {\displaystyle I} ⁠ . B {\displaystyle B} responds with their own nonce and encrypts the message with the public key of ⁠ A {\displaystyle A} ⁠ . Since I {\displaystyle I} is not in possession of the private key of A {\displaystyle A} they have to relay the message to A {\displaystyle A} without knowing the content. A decrypts the message with her private key and respond with the nonce of B {\displaystyle B} encrypted with the public key of ⁠ I {\displaystyle I} ⁠ . I {\displaystyle I} decrypts the message using their private key and is now in possession of nonce A {\displaystyle A} and ⁠ B {\displaystyle B} ⁠ . Therefore, they can now impersonate the bank and the client respectively.

The attack was first described in a 1995 paper by Gavin Lowe . The paper also describes a fixed version of the scheme, referred to as the Needham–Schroeder–Lowe protocol . The fix involves the modification of message six to include the responder's identity, that is we replace:

with the fixed version:

and the intruder cannot successfully replay the message because A is expecting a message containing the identity of I whereas the message will have identity of ⁠ B {\displaystyle B} ⁠ .