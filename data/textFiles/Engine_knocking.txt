In spark-ignition internal combustion engines , knocking (also knock , detonation , spark knock , pinging or pinking ) occurs when combustion of some of the air/fuel mixture in the cylinder does not result from propagation of the flame front ignited by the spark plug , but when one or more pockets of air/fuel mixture explode outside the envelope of the normal combustion front. The fuel–air charge is meant to be ignited by the spark plug only, and at a precise point in the piston's stroke. Knock occurs when the peak of the combustion process no longer occurs at the optimum moment for the four-stroke cycle . The shock wave creates the characteristic metallic "pinging" sound, and cylinder pressure increases dramatically. Effects of engine knocking range from inconsequential to completely destructive.

Knocking should not be confused with pre-ignition —they are two separate events. However, pre-ignition can be followed by knocking.

The phenomenon of detonation was described in November 1914 in a letter from Lodge Brothers (spark plug manufacturers, and sons of Sir Oliver Lodge ) settling a discussion regarding the cause of "knocking" or "pinging" in motorcycles. In the letter they stated that an early ignition can give rise to the gas detonating instead of the usual expansion, and the sound that is produced by the detonation is the same as if the metal parts had been tapped with a hammer. It was further investigated and described by Harry Ricardo during experiments carried out between 1916 and 1919 to discover the reason for failures in aircraft engines .

Under ideal conditions the common internal combustion engine burns the fuel/air mixture in the cylinder in an orderly and controlled fashion. The combustion is started by the spark plug some 10 to 40 crankshaft degrees prior to top dead center (TDC), depending on many factors including engine speed and load. This ignition advance allows time for the combustion process to develop peak pressure at the ideal time for maximum recovery of work from the expanding gases.

The spark across the spark plug's electrodes forms a small kernel of flame approximately the size of the spark plug gap. As it grows in size, its heat output increases, which allows it to grow at an accelerating rate, expanding rapidly through the combustion chamber. This growth is due to the travel of the flame front through the combustible fuel–air mix itself, and due to Rayleigh–Taylor instability (resulting from the hot, low-density combustion gasses expanding into the relatively cold and dense unburnt fuel–air mix) which rapidly stretches the burning zone into a complex of fingers of burning gas that have a much greater surface area than a simple spherical ball of flame would have (this latter process is enhanced and accelerated by any pre-existing turbulence in the fuel–air mixture). In normal combustion, this flame front moves throughout the fuel/air mixture at a rate characteristic for the particular mixture. Pressure rises smoothly to a peak, as nearly all the available fuel is consumed, then pressure falls as the piston descends. Maximum cylinder pressure is achieved a few crankshaft degrees after the piston passes TDC, so that the force applied on the piston (from the increasing pressure applied to the top surface of the piston) can give its hardest push precisely when the piston's speed and mechanical advantage on the crank shaft gives the best recovery of force from the expanding gases, thus maximizing torque transferred to the crankshaft.

When unburned fuel–air mixture beyond the boundary of the flame front is subjected to a combination of heat and pressure for a certain duration (beyond the delay period of the fuel used), detonation may occur. Detonation is characterized by an almost instantaneous, explosive ignition of at least one pocket of fuel/air mixture outside of the flame front. A local shockwave is created around each pocket, and the cylinder pressure will rise sharply – and possibly beyond its design limits – causing damage.  (Detonation is actually more efficient than deflagration, but is usually avoided due to its damaging effects on engine components.)

If detonation is allowed to persist under extreme conditions or over many engine cycles, engine parts can be damaged or destroyed. The simplest deleterious effects are typically particle wear caused by moderate knocking, which may further ensue through the engine's oil system and cause wear on other parts before being trapped by the oil filter. Such wear gives the appearance of erosion, abrasion, or a "sandblasted" look, similar to the damage caused by hydraulic cavitation . Severe knocking can lead to catastrophic failure in the form of physical holes melted and pushed through the piston or cylinder head (i.e. rupture of the combustion chamber ), either of which depressurizes the affected cylinder and introduces large metal fragments, fuel, and combustion products into the oil system. Hypereutectic pistons are known to break easily from such shock waves.

Detonation can be prevented by any or all of the following techniques:

Because pressure and temperature are strongly linked, knock can also be attenuated by controlling peak combustion chamber temperatures by compression ratio reduction, exhaust gas recirculation , appropriate calibration of the engine's ignition timing schedule, and careful design of the engine's combustion chambers and cooling system as well as controlling the initial air intake temperature.

The addition of tetraethyl lead (TEL), a soluble organolead compound added to gasoline, was common until it was discontinued for reasons of toxic pollution. Lead dust added to the intake charge will also reduce knock with various hydrocarbon fuels. Manganese compounds are also used to reduce knock with petrol fuel.

Knock is less common in cold climates. As an aftermarket solution, a water injection system can be employed to reduce combustion chamber peak temperatures and thus suppress detonation. Steam (water vapor) will suppress knock even though no added cooling is supplied.

Turbulence, as stated, has a very important effect on knock. Engines with good turbulence tend to knock less than engines with poor turbulence. Turbulence occurs not only while the engine is inhaling but also when the mixture is compressed and burned. Many pistons are designed to use "squish" turbulence to violently mix the air and fuel together as they are ignited and burned, which reduces knock greatly by speeding up burning and cooling the unburnt mixture. One example of this is all modern side valve or flathead engines . A considerable portion of the head space is made to come in close proximity to the piston crown, making for much turbulence near TDC. In the early days of side valve heads this was not done and a much lower compression ratio had to be used for any given fuel. Also such engines were sensitive to ignition advance and had less power.

Knocking is more or less unavoidable in diesel engines , where fuel is injected into highly compressed air towards the end of the compression stroke. There is a short lag between the fuel being injected and combustion starting. By this time there is already a quantity of fuel in the combustion chamber which will ignite first in areas of greater oxygen density prior to the combustion of the complete charge. This sudden increase in pressure and temperature causes the distinctive diesel 'knock' or 'clatter', some of which must be allowed for in the engine design.

Careful design of the injector pump, fuel injector, combustion chamber, piston crown and cylinder head can reduce knocking greatly, and modern engines using electronic common rail injection have very low levels of knock. Engines using indirect injection generally have lower levels of knock than direct injection engines, due to the greater dispersal of oxygen in the combustion chamber and lower injection pressures providing a more complete mixing of fuel and air. Diesels actually do not suffer exactly the same "knock" as gasoline engines since the cause is known to be only the very fast rate of pressure rise, not unstable combustion. Diesel fuels are actually very prone to knock in gasoline engines but in the diesel engine there is no time for knock to occur because the fuel is only oxidized during the expansion cycle. In the gasoline engine the fuel is slowly oxidizing all the time while it is being compressed before the spark. This allows for changes to occur in the structure/makeup of the molecules before the very critical period of high temperature/pressure.

Due to the large variation in fuel quality, atmospheric pressure and ambient temperature as well as the possibility of a malfunction, every modern combustion engine contains mechanisms to detect and prevent knocking.

A control loop is permanently monitoring the signal of one or more knock sensors (commonly piezoelectric sensor which are able to translate vibrations into an electric signal). If the characteristic pressure peak of a knocking combustion is detected the ignition timing is retarded by steps of a few degrees. If the signal normalizes indicating a controlled combustion the ignition timing is advanced again in the same fashion keeping the engine at its best possible operating point - the so-called ″knock limit″. Modern knock control-loop systems are able to adjust ignition timings for every cylinder individually. Depending on the specific engine the boost pressure is regulated simultaneously. This way performance is kept at its optimum while mostly eliminating the risk of engine damage caused by knock (e.g. when running on low octane fuel). An early example of this is in turbocharged Saab H engines , where a system called Automatic Performance Control was used to reduce boost pressure if it caused the engine to knock.

Since the avoidance of knocking combustion is so important to development engineers, a variety of simulation technologies have been developed which can identify engine design or operating conditions in which knock might be expected to occur. This then enables engineers to design ways to mitigate knocking combustion whilst maintaining a high thermal efficiency .

Since the onset of knock is sensitive to the in-cylinder pressure, temperature and autoignition chemistry associated with the local mixture compositions within the combustion chamber, simulations which account for all of these aspects have thus proven most effective in determining knock operating limits and enabling engineers to determine the most appropriate operating strategy.

The objective of knock control strategies is to attempt to optimize the trade-off between protecting the engine from damaging knock events and maximizing the engine's output torque. Knock events are an independent random process. It is impossible to design knock controllers in a deterministic platform. A single time history simulation or experiment of knock control methods are not able to provide a repeatable measurement of controller's performance because of the random nature of arriving knock events. Therefore, the desired trade-off must be done in a stochastic framework which could provide a suitable environment for designing and evaluating different knock control strategies performances with rigorous statistical properties.